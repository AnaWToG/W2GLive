// SPDX-FileCopyrightText: 2024 LiveKit, Inc.
//
// SPDX-License-Identifier: Apache-2.0
import { FfiRequest, FfiResponse, FfiEvent } from './proto/ffi_pb.js';
import EventEmitter from 'events';
import { FfiHandle, livekitFfiRequest, livekitInitialize, livekitCopyBuffer, livekitRetrievePtr, } from './napi/native.js';
export { FfiHandle, FfiEvent, FfiResponse, FfiRequest };
export var FfiClientEvent;
(function (FfiClientEvent) {
    FfiClientEvent["FfiEvent"] = "ffi_event";
})(FfiClientEvent || (FfiClientEvent = {}));
export class FfiClient extends EventEmitter {
    /** @internal */
    static get instance() {
        if (!FfiClient._client)
            FfiClient._client = new FfiClient();
        return FfiClient._client;
    }
    constructor() {
        super();
        livekitInitialize((event_data) => {
            let event = FfiEvent.fromBinary(event_data);
            this.emit(FfiClientEvent.FfiEvent, event);
        }, true);
    }
    request(req) {
        let request = new FfiRequest(req);
        let req_data = request.toBinary();
        let res_data = livekitFfiRequest(req_data);
        return FfiResponse.fromBinary(res_data).message.value;
    }
    copyBuffer(ptr, len) {
        return livekitCopyBuffer(ptr, len);
    }
    retrievePtr(data) {
        return livekitRetrievePtr(data);
    }
    async waitFor(predicate) {
        return new Promise((resolve, _) => {
            let listener = (ev) => {
                if (predicate(ev)) {
                    this.off(FfiClientEvent.FfiEvent, listener);
                    resolve(ev.message.value);
                }
            };
            this.on(FfiClientEvent.FfiEvent, listener);
        });
    }
}
//# sourceMappingURL=ffi_client.js.map